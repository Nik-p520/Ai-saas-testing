<div
  class="bg-[linear-gradient(180deg,#25181A,#1F1517,#1F1517)] text-[#d1bfbf] flex flex-col h-full border-r border-[#322625] font-inter transition-all duration-300 ease-in-out"
  [class.w-64]="open"
  [class.w-20]="!open"
>
  <!-- Sidebar Header / Logo + Toggle -->
  <div class="px-4 py-6 flex items-center justify-between border-b border-[#322625] relative">
    <!-- Parent container for the entire logo area -->
    <div
      class="flex items-center cursor-pointer select-none transition-all duration-300"
      (click)="!open && toggleSidebar()"
    >
      <!-- T (Static Logo Mark) -->
      <span 
        class="text-5xl font-extrabold sonsie-regular text-[#ff914d] leading-none select-none" 
      >
        T
      </span>

      <!-- Animated "estee" text -->
      <div 
        [class.max-w-full]="open"       
        [class.max-w-0]="!open"        
        class="flex overflow-hidden transition-all duration-300"
      >
        <span
          [class.opacity-100]="open"     
          [class.opacity-0]="!open"      
          class="bg-gradient-to-r from-[#ff914d] to-[#ff4c00] bg-clip-text text-transparent playwrite-co text-4xl font-bold tracking-wide whitespace-nowrap transition-opacity duration-300"
        >
          estee
        </span>
      </div>
    </div>

    <!-- Toggle Button -->
    <button
      (click)="toggleSidebar()"
      class="absolute right-2 text-[#ff4c00] hover:text-[#ff914d] transition-all duration-300 ease-in-out"
      [style.opacity]="open ? 1 : 0"
      [style.pointerEvents]="open ? 'auto' : 'none'"
    >
      <i-lucide [name]="'chevron-left'" class="h-7 w-7"></i-lucide>
    </button>
</div>

  <!-- Sidebar Menu -->
  <nav class="flex-1 px-3 py-4 space-y-1 overflow-hidden">
    <a
      *ngFor="let item of items"
      [routerLink]="item.url"
      routerLinkActive="bg-[#332425] text-white shadow-lg"
      [routerLinkActiveOptions]="{ exact: true }"
      class="flex items-center gap-3 px-4 py-3 rounded-lg text-base font-medium transition-all duration-300
             hover:bg-[#33242596] hover:text-white hover:shadow-md"
    >
      <i-lucide [name]="item.icon" class="h-5 w-5 text-[#ff4c00] shrink-0"></i-lucide>
      <span
        class="whitespace-nowrap transition-all duration-300 overflow-hidden"
        [class.opacity-100]="open"
        [class.opacity-0]="!open"
        [class.ml-2]="open"
        [class.ml-0]="!open"
      >
        {{ item.title }}
      </span>
    </a>
  </nav>

  <!-- Profile Section (Updated with Dynamic Data) -->
  <div
    class="border-t border-[#322625] px-4 py-4 flex items-center gap-3 hover:bg-[#2b1d1e] transition-all duration-200 cursor-pointer"
    [routerLink]="'/dashboard/profile'"
  >
    
    <!-- Avatar Circle -->
    <div class="relative h-10 w-10 rounded-full bg-[#332425] flex items-center justify-center text-[#ff4c00] text-xl font-bold shrink-0 overflow-hidden border border-[#322625]">
      
      <!-- 1. Skeleton Loader (Visible if loading data OR loading image) -->
      <div *ngIf="isLoading || (userAvatar && isImageLoading)" 
           class="absolute inset-0 bg-[#332425] animate-pulse z-20 flex items-center justify-center">
      </div>

      <!-- 2. Photo (Always rendered but hidden until loaded) -->
      <img *ngIf="userAvatar" 
           [src]="userAvatar" 
           (load)="onImageLoad()"
           alt="User" 
           class="absolute inset-0 w-full h-full object-cover transition-opacity duration-300"
           [class.opacity-0]="isImageLoading"
           [class.opacity-100]="!isImageLoading">

      <!-- 3. Initials (Fallback if no avatar and not loading) -->
      <!-- âœ… FIXED: Removed redundant '?' operators -->
      <span *ngIf="!userAvatar && !isLoading">{{ userName.charAt(0).toUpperCase() }}</span>

    </div>

    <!-- Name & Link -->
    <div
      class="flex flex-col transition-all duration-300 overflow-hidden"
      [class.opacity-100]="open"
      [class.opacity-0]="!open"
      [class.ml-2]="open"
      [class.ml-0]="!open"
    >
      <!-- Name Skeleton -->
      <div *ngIf="isLoading" class="h-4 w-20 bg-[#332425] rounded animate-pulse mb-1"></div>
      
      <!-- Actual Name -->
      <span *ngIf="!isLoading" class="text-white font-medium whitespace-nowrap truncate">{{ userName }}</span>
      
      <span class="text-sm text-gray-400 whitespace-nowrap">View Profile</span>
    </div>
  </div>
</div>