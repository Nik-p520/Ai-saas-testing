<div
  class="bg-gradient-to-br from-[#2b1d1d] via-[#231a1b] to-[#1b1313] border border-[#322625] rounded-2xl shadow-lg p-6 animate-fade-in text-[#d1bfbf] font-inter"
  [ngClass]="{ 'h-full flex flex-col': fullHeight }"
>
  <div class="mb-4 flex items-center justify-between flex-none">
    <div>
      <h2 class="text-xl font-semibold text-white">
        {{ limit ? 'Recent Test History' : 'All Test History' }}
      </h2>
      <p class="text-sm text-[#a59494]">
        {{ limit ? 'Your latest test runs' : 'Complete test history' }}
      </p>
    </div>

    <span *ngIf="loading" class="text-[#a59494] text-sm">Loading...</span>
  </div>

  <div *ngIf="errorMessage" class="text-red-500 text-center py-4 flex-none">
    {{ errorMessage }}
  </div>

  <div
    *ngIf="!loading && !errorMessage && filteredResults.length === 0"
    class="text-center text-[#a59494] py-4 flex-none"
  >
    No test results found.
  </div>

  <div
    *ngIf="!loading && filteredResults.length > 0"
    [ngClass]="{
      'max-h-64': !fullHeight,
      'flex-1 min-h-0': fullHeight
    }"
    class="overflow-y-auto border border-[#2c2c2c] rounded-lg"
  >
    <table class="w-full table-auto border-collapse text-sm">
      <thead class="sticky top-0 bg-[#1c1414] z-10">
        <tr class="border-b border-[#2c2c2c] text-[#bdb5b5]">
          <th class="text-left font-semibold p-2">Status</th>
          <th class="text-left font-semibold p-2">URL</th>
          <th class="text-left font-semibold p-2">Duration</th>
          <th class="text-left font-semibold p-2">Time</th>
          <th class="text-left font-semibold p-2">Delete Test</th>
        </tr>
      </thead>

      <tbody>
        <tr
          *ngFor="let test of filteredResults"
          (click)="onTestClick(test)"
          class="border-b border-[#2c2c2c] hover:bg-[#1c1414]/80 transition cursor-pointer"
        >
          <td class="p-2">
            <div class="flex items-center gap-2">
              <ng-container [ngSwitch]="test.status">
                <i-lucide *ngSwitchCase="'passed'" [name]="CheckCircle2" class="h-4 w-4 text-green-500"></i-lucide>
                <i-lucide *ngSwitchCase="'failed'" [name]="XCircle" class="h-4 w-4 text-red-500"></i-lucide>
                <i-lucide *ngSwitchDefault [name]="Clock" class="h-4 w-4 text-yellow-500 animate-pulse"></i-lucide>
              </ng-container>

              <span
                [ngClass]="{
                  'bg-green-900/30 text-green-400': test.status === 'passed',
                  'bg-red-900/30 text-red-400': test.status === 'failed',
                  'bg-yellow-900/30 text-yellow-400': test.status === 'processing'
                }"
                class="px-2 py-0.5 rounded text-sm capitalize"
              >
                {{ test.status }}
              </span>
            </div>
          </td>

          <td class="p-2 font-mono text-sm text-white truncate max-w-[250px]">
            {{ test.websiteUrl || 'N/A' }}
          </td>

          <td class="p-2 text-[#a59494]">
            {{ test.duration || '-' }}
          </td>

          <td class="p-2 text-[#a59494]">
            {{ test.executionTime ? (test.executionTime | date: 'short') : '-' }}
          </td>

          <td class="p-2">
            <button
              (click)="confirmDelete(test); $event.stopPropagation()"
              class="text-[#ff4c00] hover:text-[#ff7040] transition text-sm font-medium"
            >
              Delete
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div *ngIf="showViewAllButton && limit" class="text-right mt-3 flex-none">
    <button
      (click)="goToHistory()"
      class="text-[#ff4c00] hover:text-[#ff7040] transition text-sm font-semibold"
    >
      View All â†’
    </button>
  </div>
</div>

<div *ngIf="showDeleteConfirm" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 animate-fade-in">
  <div class="bg-[#1c1414] border border-[#2c2c2c] rounded-xl shadow-2xl p-6 w-80 text-center text-white">
    <h3 class="text-lg font-semibold mb-2">Delete Test?</h3>
    <p class="text-sm text-[#bdb5b5] mb-4">
      Are you sure you want to delete this test result? This action cannot be undone.
    </p>
    <div class="flex justify-center gap-3">
      <button (click)="deleteConfirmed()" class="px-4 py-2 bg-[#ff4c00] hover:bg-[#ff6633] text-white rounded-lg transition font-semibold">Delete</button>
      <button (click)="cancelDelete()" class="px-4 py-2 border border-[#3a3a3a] rounded-lg hover:bg-[#2a1e1e] transition text-[#d1bfbf]">Cancel</button>
    </div>
  </div>
</div>