<div class="min-h-full text-foreground space-y-6 p-6 animate-fade-in">

  <div>
    <div *ngIf="loadingUser; else userLoaded" class="animate-pulse space-y-3">
      <div class="h-12 w-1/3 bg-[#322625] rounded-lg"></div>
      <div class="h-6 w-1/4 bg-[#322625] rounded-lg opacity-60"></div>
    </div>

    <ng-template #userLoaded>
      <h1 class="text-5xl font-bold tracking-wide whitespace-nowrap">
        <span class="bg-gradient-to-r from-[#ff914d] to-[#ff4c00] bg-clip-text text-transparent">
          Hello, {{ userName }}
        </span>
      </h1>
      
      <p class="text-[rgba(255,255,255,0.6)] mt-0 text-2xl font-medium">
        Welcome back to Testee!
      </p>
    </ng-template>
  </div>

  <div class="grid gap-6 md:grid-cols-2 lg:grid-cols-4">
    
    <div *ngIf="!loadingStats && errorStats" class="bg-gradient-to-br from-[#2b1d1d] via-[#231a1b] to-[#1b1313] border border-[#322625] rounded-2xl shadow-xl p-6 col-span-full text-red-500 text-center">
      {{ errorStats }}
    </div>

    <ng-container *ngIf="loadingStats">
      <app-stat-card *ngFor="let i of [1,2,3,4]" [loading]="true"></app-stat-card>
    </ng-container>

    <ng-container *ngIf="!loadingStats && !errorStats">
      <app-stat-card
        *ngFor="let card of statCards"
        [title]="card.title"
        [value]="card.value"
        [icon]="card.icon"
        [trend]="card.trend"
        [trendUp]="card.trendUp"
        [trendDown]="card.trendDown" 
        [loading]="false"
        [error]="errorStats"
      ></app-stat-card>
    </ng-container>

  </div>

  <div class="grid gap-6 md:grid-cols-2">
    <app-test-trends-chart
      [trends]="trends"
      [loading]="loadingTrends"
      [noData]="noDataTrends"
      [error]="errorTrends">
    </app-test-trends-chart>

    <app-test-distribution-chart
      [distribution]="distribution"
      [loading]="loadingDistribution"
      [noData]="noDataDistribution"
      [error]="errorDistribution">
    </app-test-distribution-chart>
  </div>

  <div class="grid gap-6">
    <div *ngIf="loadingHistory" class="border border-[#322625] rounded-2xl p-6 bg-[#1b1313] space-y-4 animate-pulse">
        <div class="flex justify-between mb-6">
            <div class="h-6 w-32 bg-[#322625] rounded"></div>
            <div class="h-6 w-16 bg-[#322625] rounded"></div>
        </div>
        <div class="space-y-3">
            <div class="h-12 w-full bg-[#322625] rounded opacity-50" *ngFor="let i of [1,2,3,4,5]"></div>
        </div>
    </div>

    <app-test-history-table
      *ngIf="!loadingHistory"
      [limit]="5"
      [showViewAllButton]="true">
    </app-test-history-table>
  </div>

</div>